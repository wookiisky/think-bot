# 分叉功能

## 原始需求
大模型回复后，增加一个分支(branch)功能，可以基于当前对话，调用其他模型生成回答。


1 在大模型回复消息右侧悬浮按钮最下方加入：
    - 分支(branch)按钮：点击之后下方出现小的所有配置模型下拉列表，点击模型后，使用当前对话调用选中的模型
    - 删除当前分支按钮：点击之后删除当前分支回复，不是所有当前轮回复。在完成受到回复后展示
2 可以点击分支按钮，会在点击消息右侧分出新的一列，触发新的大模型调用
    - 持久化状态，和之前逻辑一致，增加branch_id来定位
3 分支消息展示：
    - 分支消息和初始回复消息并排分列展示，每个消息右方都有独立的悬浮按钮
    - 消息悬浮按钮下方展示小文本，指出使用的模型
    - 分支消息调用大模型时时，复用调用大模型的loading状态（转圈loading和中断并删除这个分支按钮），尽量复用tab loading状态，重新加载等逻辑
    
4 导出时，增加待模型名的列分割线，依次输出

注意：
1 继续聊天时，如果回复时有多个候选，默认取第一列放入消息历史
2 对话数据结构更改，每一轮回复消息变成数组，更新存储，导出，同步等
3 conversations页面复用了sidebar的对话逻辑，注意复用和保持一致
4 对话数据的向后兼容
5 branch的生命周期管理和状态交互，尽量复用已有逻辑
6 注意markdown展示

## 功能概述

实现对话界面的分叉功能，允许用户针对同一个用户消息使用不同模型生成多个回复分支，并支持分支管理、导出和同步等完整功能。

## 核心需求

1. 在assistant消息右侧悬浮按钮最下方加入分支(branch)按钮
2. 点击后显示所有模型下拉列表，选择模型后调用生成新分支
3. 之前的回复消息右侧分出新列，展示新模型的回复状态和结果
4. 回复完成后，可以继续点击分叉按钮分出更多列
5. 悬浮按钮增加删除按钮，删除所在分支的回复
6. 导出时增加模型名称标识和列分割线
7. 继续聊天时默认使用第一分支作为消息历史

