<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="common_settings_title">Think Bot Settings</title>
  <link rel="stylesheet" href="options.css">
  <link rel="stylesheet" href="styles/blacklist.css">
  <link rel="stylesheet" href="styles/cloud-import.css">
  <link rel="stylesheet" href="../js/modules/ui/confirmation-dialog.css">
  <link href="../fonts/material-icons.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- Error Display Area -->
    <div id="errorDisplayContainer" class="error-container" style="display: none;">
      <h2>Caught Error</h2>
      <pre id="errorDisplayContent"></pre>
      <button id="clearErrorBtn" class="secondary-btn small-btn">Clear Error</button>
    </div>

    <!-- Header with Title and Action Buttons -->
    <header class="header-row">
      <div class="header-content">
        <div class="header-left">
          <h1 data-i18n="common_settings_title">Think Bot Settings</h1>
          <a href="https://github.com/wookiisky/think-bot" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
          </a>
        </div>
        <div class="header-right">
          <div class="header-actions">
            <button type="button" id="exportConfigBtn" class="secondary-btn" data-i18n="options_export_config_button">Export Configuration</button>
            <button type="button" id="importConfigBtn" class="secondary-btn" data-i18n="options_import_config_button">Import Configuration</button>
            <input type="file" id="importConfigFile" accept=".json" style="display: none;">
            <button type="button" id="resetBtn" class="secondary-btn" data-i18n="options_reset_defaults_button">Reset to Defaults</button>
            <button type="button" id="saveBtn" class="btn primary-btn">
              <i class="material-icons">save</i>
              <span data-i18n="common_save">Save</span>
            </button>
            <button type="button" id="saveAndSyncBtn" class="btn primary-btn">
              <i class="material-icons">sync</i>
              <span data-i18n="options_save_and_sync">Save &amp; Sync</span>
            </button>
          </div>
        </div>
      </div>
    </header>
    
    <main>
      <form id="settingsForm">
        <div class="tabbed-layout">
          <div class="tab-list" role="tablist" aria-orientation="vertical">
            <button type="button" class="tab-button active" role="tab" aria-selected="true" data-tab-target="basic">
              <span data-i18n="options_basic_settings_title">Basic Settings</span>
            </button>
            <button type="button" class="tab-button" role="tab" aria-selected="false" data-tab-target="quick-inputs">
              <span data-i18n="options_quick_input_tabs_title">Quick Input Tabs</span>
            </button>
            <button type="button" class="tab-button" role="tab" aria-selected="false" data-tab-target="models">
              <span data-i18n="options_language_models_title">Language Models</span>
            </button>
            <button type="button" class="tab-button" role="tab" aria-selected="false" data-tab-target="cloud-sync">
              <span data-i18n="options_cloud_sync_title">Cloud Sync</span>
            </button>
            <button type="button" class="tab-button" role="tab" aria-selected="false" data-tab-target="blacklist">
              <span data-i18n="options_blacklist_settings_title">Blacklist Settings</span>
            </button>
          </div>
          <div class="tab-panels">
            <section id="tab-basic" class="tab-panel active" role="tabpanel">
              <section class="settings-section">
                <div class="section-header">
                  <h2 data-i18n="options_basic_settings_title">Basic Settings</h2>
                </div>
                <div class="form-group cache-item-group">
                  <label data-i18n="options_cache_label">Local Data:</label>
                  <p><span id="totalCacheDisplay">0B</span></p>
                  <button type="button" id="clearAllCacheBtn" class="secondary-btn small-btn" data-i18n="common_clear">Clear</button>
                </div>
                <div class="floating-label-field">
                  <select id="defaultModelSelect" name="defaultModelSelect">
                    <!-- Options will be populated dynamically -->
                  </select>
                  <label for="defaultModelSelect" class="floating-label" data-i18n="common_model">Model</label>
                </div>

                <div class="floating-label-field">
                  <div class="custom-multi-select" id="branchModelSelect" name="branchModelSelect">
                    <div class="multi-select-container">
                      <div class="selected-items" id="selected-branch-models">
                        <span class="no-models-selected"></span>
                      </div>
                      <div class="multi-select-dropdown">
                        <button type="button" class="dropdown-toggle" id="branch-models-toggle">
                          <i class="material-icons">arrow_drop_down</i>
                        </button>
                        <div class="dropdown-options" id="branch-models-dropdown">
                          <!-- Options will be populated dynamically -->
                        </div>
                      </div>
                    </div>
                  </div>
                  <label for="branchModelSelect" class="floating-label" data-tooltip-i18n="common_branch_models_tooltip" data-i18n="common_branch_models">Branch Models</label>
                </div>

                <div class="floating-label-field">
                  <select id="theme" name="theme">
                    <option value="light" data-i18n="options_theme_light">Light</option>
                    <option value="dark" data-i18n="options_theme_dark">Dark</option>
                    <option value="system" data-i18n="options_theme_system">System</option>
                  </select>
                  <label for="theme" class="floating-label" data-i18n="options_theme_label">Theme</label>
                </div>

                <div class="floating-label-field">
                  <select id="languageSelector" name="language">
                    <option value="en" data-i18n="options_language_english">English</option>
                    <option value="zh_CN" data-i18n="options_language_chinese">简体中文</option>
                    <!-- More languages can be added here -->
                  </select>
                  <label for="languageSelector" class="floating-label" data-i18n="options_language_label">Language</label>
                </div>

                <div class="floating-label-field">
                  <textarea id="systemPrompt" name="systemPrompt" rows="3"></textarea>
                  <label for="systemPrompt" class="floating-label" data-tooltip-i18n="options_system_prompt_tooltip" data-i18n="options_system_prompt_label">System Prompt</label>
                </div>

                <div class="form-group">
                  
                    <span class="toggle-switch">
                      <input type="checkbox" id="filterCOT" name="filterCOT">
                      <span class="slider"></span>
                    </span>
                    <span  data-i18n="options_filter_cot_label">Filter COT (Chain of Thought) in streaming output</span>
                  </label>
                </div>
              </section>

              <section class="settings-section">
                <div class="section-header">
                  <h2 data-i18n="options_content_extraction_title">Content Extraction</h2>
                </div>

                <div class="floating-label-field">
                  <input type="number" id="contentDisplayHeight" name="contentDisplayHeight" min="0" max="600">
                  <label for="contentDisplayHeight" class="floating-label" data-i18n="options_extracted_content_height_label">Extracted Content Height</label>
                </div>

                <div class="floating-label-field">
                  <select id="defaultExtractionMethod" name="defaultExtractionMethod">
                    <option value="readability" data-i18n="options_extraction_method_readability">Readability.js (Default)</option>
                    <option value="jina" data-i18n="options_extraction_method_jina">Jina AI</option>
                  </select>
                  <label for="defaultExtractionMethod" class="floating-label" data-i18n="options_default_extraction_method_label">Default Extraction Method</label>
                </div>

                <div class="floating-label-field" id="jinaApiKeyGroup">
                  <input type="password" id="jinaApiKey" name="jinaApiKey">
                  <label for="jinaApiKey" class="floating-label" data-i18n="options_jina_api_key_label">Jina AI API Key (Optional)</label>
                </div>

                <div class="floating-label-field" id="jinaResponseTemplateGroup">
                  <textarea id="jinaResponseTemplate" name="jinaResponseTemplate" rows="3"></textarea>
                  <label for="jinaResponseTemplate" class="floating-label" data-i18n="options_jina_response_template_label">Jina AI Response Template</label>
                  <small data-i18n="options_jina_response_template_description">Template for formatting Jina AI JSON response. Available placeholders: {title}, {url}, {description}, {content}.</small>
                </div>
              </section>
            </section>

            <section id="tab-quick-inputs" class="tab-panel" role="tabpanel" hidden>
              <section class="settings-section main-section">
                <div class="section-header">
                  <h2 data-i18n="options_quick_input_tabs_title">Quick Input Tabs</h2>
                  
                  <div class="section-header-actions">
                    <button type="button" id="importCloudConfigBtn" class="add-model-btn-inline add-model-btn-orange">
                      <i class="material-icons">cloud_download</i>
                      <span data-i18n="options_import_cloud_config_button">Import Cloud Config</span>
                    </button>
                    <button type="button" id="addQuickInputBtn" class="add-model-btn-inline">
                      <i class="material-icons">add</i>
                      <span data-i18n="options_add_quick_input_button">Add Quick Input</span>
                    </button>
                  </div>
                 
                </div>
                <div>
                  <p data-i18n="options_quick_input_tabs_description"></p>
                  <p data-i18n="options_quick_input_tabs_description2"></p>
                </div>
                
                <div class="quick-inputs-section">
                  <div class="quick-inputs-table">
                    <div class="quick-inputs-table-header">
                      <div class="qi-col qi-col-drag"></div>
                      <div class="qi-col qi-col-name" data-i18n="options_quick_input_button_text_label">Button Text</div>
                      <div class="qi-col qi-col-message" data-i18n="options_quick_input_message_label">Message</div>
                      <div class="qi-col qi-col-branch" data-i18n="common_branch_models">Branch Models</div>
                      <div class="qi-col qi-col-auto" data-i18n="options_quick_input_auto_trigger_title">Auto Trigger</div>
                      <div class="qi-col qi-col-actions"></div>
                    </div>
                    <div id="quickInputsContainer" class="quick-inputs-container table-body">
                      <!-- Quick input items will be added here dynamically -->
                    </div>
                  </div>
                </div>
              </section>
            </section>

            <section id="tab-models" class="tab-panel" role="tabpanel" hidden>
              <section class="settings-section main-section">
                <div class="section-header">
                  <h2 data-i18n="options_language_models_title">Language Models</h2>
                  <button type="button" id="addModelBtn" class="add-model-btn-inline">
                    <i class="material-icons">add</i>
                    <span data-i18n="options_add_new_model_button">Add New Model</span>
                  </button>
                </div>
                <div class="models-section">
                  <div class="models-table">
                    <div class="models-table-header">
                      <div class="col col-drag"></div>
                      <div class="col col-name" data-i18n="options_model_display_name_label">Display Name</div>
                      <div class="col col-provider" data-i18n="options_model_provider_label">Provider</div>
                      <div class="col col-model" data-i18n="common_model">Model</div>
                      <div class="col col-enabled"></div>
                      <div class="col col-actions"></div>
                    </div>
                    <div id="modelsContainer" class="models-container table-body">
                      <!-- Model configurations will be added here dynamically -->
                    </div>
                  </div>
                </div>
              </section>
            </section>

            <section id="tab-cloud-sync" class="tab-panel" role="tabpanel" hidden>
              <section class="settings-section">
                <div class="section-header">
                  <h2 data-i18n="options_cloud_sync_title">Cloud Sync</h2>
                </div>
                <p><small data-i18n="options_cloud_sync_description" data-i18n-html>
                  Sync your config (<strong>INCLUDE api-key</strong>) and data
                </small>
              </p>

                <!-- Storage Type Selection -->
                <div class="floating-label-field">
                  <select id="storageType" name="storageType">
                    <option value="gist" data-i18n="options_storage_type_gist">GitHub Gist</option>
                    <option value="webdav" data-i18n="options_storage_type_webdav">WebDAV</option>
                  </select>
                  <label for="storageType" class="floating-label" data-i18n="options_storage_type_label">Storage Type</label>
                </div>

                <!-- Gist Configuration -->
                <div id="gistConfigGroup" class="sync-config-group" style="display: block;">
                  <div class="floating-label-field">
                    <input type="password" id="gistToken" name="gistToken">
                    <label for="gistToken" class="floating-label" data-i18n="common_github_token">GitHub Token</label>
                    <small><a href="https://github.com/settings/tokens" target="_blank" data-i18n="options_github_token_create_link">Create token</a><span data-i18n="options_github_token_permission_note">(Requires Gist permission)</span></small>
                  </div>

                  <div class="floating-label-field">
                    <input type="text" id="gistId" name="gistId">
                    <label for="gistId" class="floating-label" data-i18n="options_gist_id_label">Secret Gist ID</label>
                    <small><span data-i18n="options_gist_id_create_link_prefix">Create a </span><a href="https://gist.github.com/" target="_blank" data-i18n="options_gist_id_create_link">secret Gist</a><span data-i18n="options_gist_id_create_link_suffix">(DO NOT create public gist)</span></small>
                  </div>
                </div>

                <!-- WebDAV Configuration -->
                <div id="webdavConfigGroup" class="sync-config-group" style="display: none;">
                  <div class="floating-label-field">
                    <input type="url" id="webdavUrl" name="webdavUrl" placeholder=" ">
                    <label for="webdavUrl" class="floating-label" data-i18n="options_webdav_url_label">WebDAV URL</label>

                  </div>

                  <div class="floating-label-field">
                    <input type="text" id="webdavUsername" name="webdavUsername" placeholder=" ">
                    <label for="webdavUsername" class="floating-label" data-i18n="options_webdav_username_label">Username</label>
                  </div>

                  <div class="floating-label-field">
                    <input type="password" id="webdavPassword" name="webdavPassword" placeholder=" ">
                    <label for="webdavPassword" class="floating-label" data-i18n="options_webdav_password_label">Password</label>
                  </div>

                </div>

                <div id="syncConfigGroup" class="sync-config-group">

                  <div class="form-group sync-controls">
                    <div class="sync-toggle-container">
                      <label class="toggle-switch-label">
                        <span class="toggle-switch">
                          <input type="checkbox" id="syncEnabled" name="syncEnabled">
                          <span class="slider"></span>
                        </span>
                        <span data-i18n="options_sync_on_save_label">Sync when Save</span>
                      </label>
                    </div>
                    <div class="manual-sync-action">
                      <button type="button" id="manualSyncBtn" class="secondary-btn small-btn">
                        <i class="material-icons">sync</i>
                        <span data-i18n="options_manual_sync_button">Sync Now</span>
                      </button>
                    </div>
                  </div>

                  <div class="sync-status" id="syncStatus">
                    <div class="status-details" id="syncStatusDetails">
                      <div class="status-text" id="syncStatusText" data-i18n="options_sync_status_not_configured">Not configured</div>
                      <small id="syncErrorMessage" class="error-message" style="display: none;"></small>
                    </div>
                  </div>

                </div>
              </section>
            </section>

            <section id="tab-blacklist" class="tab-panel" role="tabpanel" hidden>
              <section class="settings-section">
                <div class="section-header">
                  <h2 data-i18n="options_blacklist_settings_title">Blacklist Settings</h2>
                </div>
                <div class="blacklist-description">
                  <p data-i18n="options_blacklist_description">Confirm before run Think Bot</p>
                </div>

                <div class="blacklist-controls">
                  <button type="button" id="addBlacklistBtn" class="secondary-btn small-btn">
                    <i class="material-icons">add</i>
                    <span data-i18n="common_add">Add</span>
                  </button>
                  <button type="button" id="resetBlacklistBtn" class="secondary-btn small-btn">
                    <i class="material-icons">refresh</i>
                    <span data-i18n="common_reset">Reset</span>
                  </button>
                </div>

                <div class="blacklist-table-container">
                  <table class="blacklist-table">
                    <thead>
                    </thead>
                    <tbody id="blacklistTableBody">
                      <!-- Dynamic content will be inserted here -->
                    </tbody>
                  </table>
                </div>
              </section>
            </section>
          </div>
        </div>
      </form>
    </main>
  </div>

  <!-- Quick Input Template (hidden) -->
  <template id="quickInputTemplate">
    <div class="quick-input-item">
      <div class="quick-input-item-header" role="button" tabindex="0" aria-expanded="false">
        <div class="qi-col qi-col-drag">
          <div class="drag-handle">
            <i class="material-icons">drag_indicator</i>
          </div>
        </div>
        <div class="qi-col qi-col-name">
          <span class="quick-input-name-display empty" data-i18n-empty="options_quick_input_default_name"></span>
        </div>
        <div class="qi-col qi-col-message">
          <div class="quick-input-message-preview" data-i18n-empty="options_quick_input_message_label"></div>
        </div>
        <div class="qi-col qi-col-branch">
          <div class="quick-input-branch-field">
            <label class="quick-input-branch-label sr-only" data-i18n="common_branch_models">Branch Models</label>
            <div class="custom-multi-select quick-input-branch-models quick-input-branch-select">
              <div class="multi-select-container">
                <div class="selected-items quick-input-selected-branch-models">
                  <span class="no-models-selected"></span>
                </div>
                <div class="multi-select-dropdown">
                  <button type="button" class="dropdown-toggle quick-input-branch-models-toggle">
                    <i class="material-icons">arrow_drop_down</i>
                  </button>
                  <div class="dropdown-options quick-input-branch-models-dropdown">
                    <!-- Options will be populated dynamically -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="qi-col qi-col-auto">
          <label class="toggle-switch" data-i18n-title="options_quick_input_auto_trigger_title" title="Auto-trigger when sidebar opens">
            <input type="checkbox" class="auto-trigger-checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="qi-col qi-col-actions">
          <button type="button" class="remove-quick-input-btn icon-btn danger" data-i18n-title="common_remove" title="Remove Quick Input">
            <i class="material-icons">delete</i>
          </button>
        </div>
      </div>
      <div class="quick-input-item-body">
        <div class="floating-label-field quick-input-display-field">
          <input type="text" class="quick-input-display" placeholder=" ">
          <label class="floating-label quick-input-display-label" data-i18n="options_quick_input_button_text_label">Button Text</label>
        </div>
        <div class="floating-label-field">
          <textarea class="quick-input-send" rows="10" placeholder=" "></textarea>
          <label class="floating-label quick-input-send-label" data-i18n="options_quick_input_message_label">Message</label>
        </div>
      </div>
    </div>
  </template>
  
  <script src="../js/modules/logger.js"></script>
  <script src="../js/modules/i18n.js" type="module"></script>
  <script src="../js/lib/pako.min.js"></script>
  <script src="../js/lib/compression.js"></script>
  <script src="../js/modules/storage-keys.js"></script>
  <script src="../js/modules/storage-config-manager.js"></script>
  <script src="../js/modules/blacklist-manager.js"></script>
  <script src="../js/modules/sync/sync_config.js"></script>
  <script src="../js/modules/sync/gist_client.js"></script>
  <script src="../js/modules/sync/webdav_client.js"></script>
  <script src="../js/modules/sync/data_serializer.js"></script>
  <script src="../js/modules/sync/sync_manager.js"></script>
  <script src="../js/lib/Sortable.min.js"></script>
  <script src="modules/floating-label.js" type="module"></script>
  <script src="modules/blacklist-config.js" type="module"></script>
  <script src="modules/cloud-import-dialog.js" type="module"></script>
  <script src="options.js" type="module"></script>
</body>
</html> 
